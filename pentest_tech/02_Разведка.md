# 2. Этап разведки и сбора информации об объекте тестирования

## Что такое разведка и сбор информации (Information Gathering)

> **Разведка и сбор информации об объекте тестирования на проникновение**<br>это процесс получения данных, который используется для сбора и валидации активов объекта тестирования, планирования сценариев, выявления потенциальных векторов получения первоначального доступа, поиска уязвимостей и недостатков конфигурации.

включает в себя пассивный
- сбор и анализ информации полученной из открытых источников (OSINT)
- активное сканирование портов
- определение сервисов и версий используемого ПО для дальнейшего поиска уязвимостей

**Цель разведки**<br>собрать достаточно данных для планирования и проведения эффективного тестирования на проникновение, чтобы оценить уровень защищенности и своевременно выявить возможные угрозы.

> **Пассивный сбор и анализ информации полученной из открытых источников (OSINT)**<br>это метод получения данных, который включает в себя поиск и изучение информации, доступной в интернете и других общедоступных ресурсах.

- Пассивный OSINT отличается от активного тем, что не предполагает прямого взаимодействия с целевой системой или объектом
- информация из общедоступных источников: 
    - общих поисковых систем (Google Dorks)
	- специализированных поисковых систем
        - Shodan
        - Censys
        - Fofa
        - ZoomEye
        - Netlas
	- социальных сетей
	- каналов Telegram
	- форумов
	- блогов и т.д.

## Google Dorks

Типы информации, доступные через Google Dorks представлены [на этой странице](https://www.exploit-db.com/google-hacking-database).

С помощью Google Dorks можно найти разнообразную информацию:
- **Информация о людях**<br>Google Dorks позволяют искать людей по ФИО, адресу электронной почты, номеру телефона и другим данным.
    - Например: `site:anti-malware.ru "Шелест Вадим"`
- **Документы**<br>можно искать документы различных типов (PDF, DOC, XLS и др.) по ключевым словам, содержанию сайта или домену.
    - Например: `сотрудники site:*.wildberries.ru filetype:pdf`
- **Сайты и поддомены**<br>Google Dorks помогают находить домены и поддомены, соответствующие определенным критериям.
    - Например: `site:wildberries.ru -inurl:http://wildberries.ru`
- **Уязвимости**<br>некоторые Google Dorks могут использоваться для поиска уязвимостей.
- **Кэшированные версии сайтов**<br>Dork "cache:"
    - Например: `cache:www.wildberries.ru`
    - При его использовании будет показана версия сайта, которая была сохранена в кэше Google. Там же будут указаны время и дата, когда эта версия туда попала. Посмотреть на сайт можно в трех вариантах: полный вид, текстовая версия и исходный код.
- Дорки intitle: и allintitle: позволяют искать по **заголовку страницы**.
    - `Intitle`: ищет по тому слову, которое указано после двоеточия.
    - `allintitle`: ищет по фразе, которая указана после двоеточия.
- AROUND(). Он помогает искать, когда вы **не знаете точное количество слов между элементами запроса**
    - Например: `Шелест Вадим AROUND(5) red teaming`
    - указываете предполагаемое количество слов в скобках.
    - Такой запрос найдет страницы, содержащие эти слова в указанном порядке, с возможным количеством других слов между ними.

## Специализированные поисковые системы

для различных целей, включая:
- поиск активов объектов тестирования на проникновение на внешнем сетевом периметре (домены, поддомены);
- поиск уязвимостей без активного сканирования;
- мониторинг изменений активов объектов тестирования, обнаружение новых ресурсов (IP-адреса, порты и сервисы).

### Shodan

https://www.shodan.io/

- **Открытые порты и сервисы**<br>Shodan показывает, какие сервисы и порты открыты на устройстве и доступны из интернета.
- **Географическое положение**<br>Shodan может определить местоположение устройства.
- **Мониторинг сети**<br>Shodan Monitor позволяет отслеживать устройства, подключенные к интернету в вашей сети, и получать уведомления в режиме реального времени о появлении новых устройств.
- **API для автоматизации и интеграции в собственные инструменты**<br>разработчики могут использовать API Shodan для доступа ко всем функциям платформы, включая сканирование, поиск и загрузку полученных данных в разных форматах.

фильтры: https://www.shodan.io/search/filters

Примеры:
- Поиск по наименование организации: `org:Wildberries`
- Поиск по ASN принадлежащей объекту тестирования: `asn:AS57073`

### Censys

https://search.censys.io/

- фокусируется на предоставлении наиболее полной, точной и актуальной карты интернета
- предоставляет более широкий спектр данных и инструментов для анализа всего интернет-пространства для поиска всех активов объектов тестирования на проникновение на внешнем сетевом периметре

### Fofa

https://fofa.info/

- китайская поисковая система, которая позволяет эффективно искать активы в азиатском сегменте интернета, в отличие от Shodan показывает значительно больше результатов поиска по Favicon.

### ZoomEye

https://www.zoomeye.hk/

- китайская поисковая система, которая показывает хорошие результаты в азиатском сегменте интернета

### Netlas

https://netlas.io/

- поисковая система, которая регулярно сканирует каждый IPv4-адрес всемирной паутины, определяет открытые порты и идентифицирует запущенные сервисы
- Собранная информация дополнительно обогащается данными на основе DNS registry, IP WHOIS, Domain WHOIS и выданных SSL-сертификатов

Сервис доступен через веб-интерфейс, REST API и консольную утилиту Netlas CLI любому зарегистрированному пользователю, с ограничением 50 запросов в день и не более 2500 хостов в результатах поиска в месяц

Репо на github: https://github.com/netlas-io
- скрипты для поиска доменов, поддоменов, диапазонов IP- адресов, CIDR: https://github.com/netlas-io/netlas-scripts/blob/main/netlas_domains_and_ip_recon.sh
- определения живых хостов на основе ответов серверов: https://github.com/netlas-io/netlas-scripts/blob/main/netlas_download_http_responses.sh
- Netlas dorks: https://github.com/netlas-io/netlas-dorks

Примеры:

- Поиск поддоменов<br>`netlas search "domain:*.github.com OR host:*.github.com" -f json`
- Поиск сайтов с конкретными уязвимостями<br>`netlas search "cve.name:CVE-2022-22965" -f json`
- Поиск сайтов с уязвимостями, содержащими определённое слово в описании<br>`netlas search "cve.description:weblogic AND cve.has_exploit:true" -f json`
- Поиск по HTTP-заголовку сервера<br>`netlas search 'http.headers.server:"yawcam"' -f json`
- Поиск серверов с CVEs по хэшу фавикона<br>`netlas search "http.favicon.hash_sha256:ebaaed8ab7c21856f888117edaf342f6bc10335106ed907f95787b69878d9d9e" -f json`
- Поиск серверов с CVEs по имени тега<br>`netlas search 'tag.name:"adobe_coldfusion"' -f json`
- Поиск уязвимых серверов и устройств рядом с вами (или в другом месте)<br>`geo.city:London AND cve:*`
- Поиск логин/админ панелей:<br>`http.title:admin http.title:panel`
- Поиск уязвимых админ панелей баз данных:<br>`http.title:(phpPgAdmin OR pgadmin) cve:*`
- Поиск сайтов, уязвимых для SQL-инъекций:<br>`netlas search "http.body:mysql_fetch_array http.body:warning" -f json`
- Поиск никнейма или email в WHOIS-контактах:<br>`netlas search "whois.related_nets.contacts.emails:sweetwater*" -f json`
- Поиск никнейма или email в заголовке и теле веб-страницы:<br>`netlas search "http.title:sweetwater OR http.body:sweetwater" -f json`
- Поиск ссылок на «важные файлы» на поддоменах сайта компании:<br>`netlas search "uri:*lidl.* AND http.body:pdf"`
- Поиск упоминаний номеров телефонов:<br>`netlas search "http.body:1?234?567?89?99 OR http.body:12345678999 OR http.body:1234?5678?999" -f json`
- Поиск упоминаний файлов (возможное нарушение авторских прав):<br>`netlas search "(http.title:alla OR http.body:alla) AND http.body:*.mp3" -f json`
- Сбор WHOIS-информации о домене:<br>`netlas host github.com -f json`
- Поиск по тексту баннеров FTP-сервера:<br>`netlas search 'ftp.banner:"Collado"' -f json`
- Поиск контактной информации в SSL-сертификатах:<br>`netlas search "certificate.issuer.street_address:*mcgill*" -f json`
- Использование Netlas как альтернативы WayBack Machine:<br>`http.title:"github.com"`
- Поиск связанных сайтов:<br>`http.body:UA-23870775`
- Поиск майнинговых ферм:<br>`http.headers.www_authenticate:XMR-Stak-Miner`
- Поиск сайтов, зараженных криптомайнерами:<br>`netlas search "http.body:coinhive.min.js domain:*"`
- Поиск уязвимых Bitcoin-нод:<br>`netlas search "port:8333 cve:*"`

Рекомендуем также ознакомиться со статьей [«A week in the life of a GreyNoise Sensor: The benign view»](https://www.greynoise.io/blog/new-sensor-benign-activity), опубликованной в блоге Greynoise.

## Определение ПО веб-сервера приложения

### Анализ баннеров (Banner Grabbing)

- заключается в отправке HTTP-запроса на веб-сервер и анализе заголовка ответа
- Заголовок «Server» обычно содержит информацию об используемом ПО и версии веб-сервера
- Для отправки запросов и получения ответов можно использовать такие инструменты, как netcat и openssl

**Ответ веб-сервера Apache/2.4.62**

```
HTTP/1.1 200 OK
Date: Mon, 04 Nov 2024 17:42:39 GMT
Server: Apache/2.4.62 (Unix)
Last-Modified: Thu, 05 Sep 2022 17:40:42 GMT
ETag: "75-59145f75f854f7"
Accept-Ranges: bytes
Content-Length: 117
Connection: close
Content-Type: text/html
```

**Ответ веб-сервера nginx/1.17.3**

```
HTTP/1.1 200 OK
Server: nginx/1.24.0
Date: 04 Nov 2024 17:49:39 GMT
Content-Type: text/html
Content-Length: 117
Last-Modified: Thu, 05 Sep 2019 17:40:42 GMT
Connection: close
ETag: "5d771189a-77"
Accept-Ranges: bytes
```

- разработчики, заботящиеся о безопасности, могут скрывать информацию о сервере, изменяя заголовок «Server»
- можно попытаться определить тип сервера, анализируя порядок полей в заголовках, но этот метод не дает абсолютно точных результатов.

Порядок полей в заголовках для веб-сервера Apache:
1. Date,
1. Server,
1. Last-Modified,
1. ETag,
1. Accept-Ranges,
1. Content-Length,
1. Connection,
1. Content-Type.

### Отправка некорректных запросов

- Веб-серверы могут быть идентифицированы по их ответам на некорректные или искаженные запросы
- Анализируя страницы ошибок и стандартные сообщения об ошибках, можно получить информацию о типе и версии сервера

**Пример**

*Запрос*

```
GET / EASY BUGS/1.1
```

*Ответ веб-сервера Apache/2.4.62*

```
HTTP/1.1 400 Bad Request
Date:Mon, 04 Nov 2024 17:42:39 GMT
Server: Apache/2.4.62 (Unix)
Content-Length: 224
Connection: close
Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>400 Bad Request</title>
</head><body>
<h1>Bad Request</h1>
<p>Your browser sent a request that this server could not understand.<br />
</p>
</body></html>
```

*Ответ веб-сервера nginx/1.17.3*

```
<html>
<head><title>404 Not Found</title></head>
<body>
<center><h1>404 Not Found</h1></center>
<hr><center>nginx/1.17.3</center>
</body>
</html>
```

### Анализ метафайлов веб-сервера

- заключается в анализе метафайлов веб-сервера, которые могут содержать информацию о системе
- Такая информация может быть использована для проведения атак

Метафайлы, такие как robots.txt и sitemap.xml, часто содержат информацию, которая помогает понять структуру сайта и технологии, используемые на сервере

Файл **robots.txt**, расположенный в корневом каталоге веб-сервера, содержит инструкции для поисковых роботов. В нем указывается, какие разделы сайта разрешено индексировать

**Запрос**

```
curl -O -Ss http://www.wildberries.ru/robots.txt && head -n5 robots.txt
```

**Раскрывает содержание robots.txt**

```
User-agent: *
Allow: /search
Allow: /search/items
Disallow: /search/users
Disallow: /admin/login
Disallow: /static/backups
```

Анализ robots.txt может выявить:
- Скрытые директории и файлы, которые не предназначены для публичного доступа.
- Используемые технологии, например, если указаны правила для конкретных поисковых роботов.

> **META-теги**<br>это элементы HTML, которые содержат метаданные о веб-странице.

Тег Robots определяет правила индексации страницы для поисковых роботов.

Другие информационные теги могут содержать информацию о технологиях, используемых на сайте, а также о дополнительных путях и функциональности.

> **Карта сайта**<br>это файл, который содержит информацию о структуре сайта и его страницах.

Анализ карты сайта может помочь получить представление о структуре сайта, обнаружить страницы, которые недоступны через обычную навигацию.

Помимо структурных данных, полезно изучить файлы, содержащие информацию о политике сайта. Эти файлы помогают понять меры безопасности сайта и способы связи с администрацией.

Файл security.txt содержит информацию о политике безопасности сайта и контактные данные для сообщения об уязвимостях.

### Поиск чувствительной информации в исходном коде веб-страниц

- Часто разработчики оставляют подробные комментарии и учетные данные в исходном коде веб-страниц
- полезно для целей отладки, но также может привести к утечке конфиденциальной информации, если эти комментарии и метаданные останутся в производственной среде

В HTML:

```
<!-- DB administrator password for testing: $up3rs3cr3tP@a$ -->
```

многие разработчики также хардкодят конфиденциальную информацию в переменных JavaScript на стороне клиента. Эта информация может включать приватные API-ключи, внутренние IP-адреса, конфиденциальные маршруты и учетные данные.

> **Файл Source Map**<br>это специальный файл, который используется в веб-разработке для сопоставления минимизированного или перекомпилированного кода с его исходным кодом.

- Файл Source Map может содержать сведения о системе, которые потенциально могут быть использованы злоумышленниками для атак.
- Найти файлы Source Map можно, добавив расширение «.map» после расширения каждого внешнего JavaScript файла.

### Анализ заголовков HTTP

**Заголовок X-Powered-By**

- может прямо указывать на используемую технологию, например, PHP или ASP.NET

```
nc 127.0.0.1 80
HEAD / HTTP/1.0

HTTP/1.1 200 OK
Server: nginx/1.0.14
[...]
X-Powered-By: Mono
```

- заголовок **X-Generator** может раскрыть использование фреймворка Swiftlet, даже если X-Powered-By указывает только на PHP.

```
HTTP/1.1 200 OK
Server: nginx/1.4.1
Date: Sat, 07 Sep 2013 09:22:52 GMT
Content-Type: text/html
Connection: keep-alive
Vary: Accept-Encoding
X-Powered-By: PHP/5.4.16-1~dotdeb.1
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
X-Generator: Swiftlet
```

### Анализ файлов cookie

Фреймворки часто устанавливают свои собственные файлы cookie, которые могут быть использованы для их идентификации. Хотя имена дефолтных значений для cookie также можно изменить, это делается значительно реже, чем изменение заголовков.

### Анализ исходного кода HTML

- В исходном коде HTML страницы можно найти множество подсказок об используемом фреймворке. HTML-комментарии могут содержать прямые упоминания об используемом фреймворке, оставленные разработчиками.
- пути к файлам или ссылки на CSS и JavaScript файлы часто содержат названия фреймворков и используемых компонентов.

### Техника перебора директорий и файлов (Dirbusting)

> техника перебора директорий и файлов на сервере с целью обнаружения скрытого содержимого.

Каждый фреймворк имеет свою структуру папок и файлов, и успешный dirbusting может выявить наличие WordPress, Drupal или других популярных платформ.

Для перебора директорий и файлов используются словари известных путей и имен файлов, пример можно найти по ссылке: https://github.com/danielmiessler/SecLists/tree/master/Fuzzing

### Анализ расширений файлов

Расширения файлов в URL-адресах также могут указывать на используемые технологии. Например, .php указывает на PHP, .aspx — на ASP.NET, а .jsp — на Java Server Pages.

### Анализ сообщений об ошибках

Сообщения об ошибках, генерируемые веб-приложением, могут содержать информацию о путях к файлам и используемых функциях, что также помогает в идентификации фреймворка.

### Автоматизированные инструменты

- [WhatWeb](https://github.com/urbanadventurer/WhatWeb)<br>Использует различные методы, включая поиск строк, регулярные выражения и MD5-хеши.
- [Wappalyzer](https://github.com/xscorp/wappalyzer)<br>Доступен как инструмент командной строки и расширение для браузера. Работает на основе сопоставления с базой фингерпринтов, построенной с использованием регулярных выражений.

# 3. Активная фаза. Сканирование

## 1. Сетевое сканирование: определение и типы

> **Сетевое сканирование**<br>это процесс анализа сети для идентификации активных устройств, открытых портов и используемых сервисов.

два типа:
1. **Сканирование IP-адресов (или discovery scan)**
    - сканирование, которое запускается только с целью определения живых хостов в сети.
    - Чаще всего производится с помощью протокола ICMP. По этому протоколу отправляется эхо-запрос по указанному IP-адресу. Если приходит эхо-ответ — значит, данный узел присутствует в сети.
1. **Сканирование портов**
    - метод, основанный на попытке пробного подключения к портам TCP и UDP с целью определения запущенных служб и соответствующих им портов.

Определение портов, находящихся в режиме ожидания, позволяет выявить тип используемой ОС, а также запущенные приложения и их версии.

сканирование портов можно разделить на следующие типы:
1. **TCP-сканирование**
    - заключается в попытке подключения по TCP-протоколу к нужному порту с прохождением полной процедуры согласования соединения.
    - определение сервисов, работающих по протоколу TCP
1. **UDP-сканирование**
	- заключается в отправке сообщений и пакетов по протоколу UDP.
    - поступает сообщение, что порт недоступен, — значит, он закрыт, и наоборот
    - UDP-протокол ненадежен, а процесс UDP-сканирования очень медленный, поэтому к этому сканированию прибегают редко
1. **SYN-сканирование**
	- заключается в том, что полного подключения к порту не происходит, а к порту посылается сообщение SYN.
    - в ответ приходит ответ SYN/ACK, то данный порт находится в режиме прослушивания
    - Данный метод является более скрытым, чем предыдущий, поскольку полного TCP-соединения не устанавливается

## 2. Использование сканера Nmap

Существует ряд инструментов, которые специалисты используют для сетевых сканирований
- **Masscan**<br>инструмент для сетевого сканирования, который долгое время был лидером по скорости за счет использования кастомного сетевого стека.
- **Zmap**<br>инструмент предназначенный для сканирования больших скоупов, так как может сканировать все общедоступное адресное пространство IPv4 на одном порту менее чем за 45 минут.
- **Naabu**<br>инструмент для сетевого сканирования, разработанный компанией Project Discovery.
- **RustScan**<br>еще один инструмент для сканирования портов, который отличается высокой скоростью работы. Он использует асинхронное сканирование, что позволяет ему обрабатывать большое количество портов за короткий промежуток времени.
- **Nimscan**<br>еще один быстрый сканнер, особенностью которого является то что он предназначен для использования в ОС Windows.

> **Nmap (сокр. от Network Mapper)**<br>это инструмент с открытым исходным кодом, который используется для сканирования IP-адресов и портов в сети и обнаружения установленных приложений, а также проведения дополнительных проверок, в том числе на наличие уязвимостей.

### Преимущества Nmap

- помогает быстро составить карту сети без сложных команд или конфигураций
- поддерживает простые команды
- сложные сценарии с помощью скриптового движка Nmap.

Что можно делать с помощью Nmap:
- быстро распознавать все устройства, включая серверы, маршрутизаторы, коммутаторы, мобильные устройства и т. д., в одной или нескольких сетях;
- идентифицировать службы, запущенные в системе, включая веб-серверы, DNS-серверы и другие распространенные приложения;
- определять версии приложений;
- искать информацию об операционной системе, запущенной на устройствах;
- во время аудита безопасности и сканирования уязвимостей вы можете использовать Nmap для атаки систем с использованием существующих скриптов из Nmap Scripting Engine;
- Nmap имеет графический пользовательский интерфейс под названием Zenmap, который может показывать карты сети для улучшения удобства использования и отчетности.

### Команды Nmap

| Команда | Описаине |
| :------ | :------- |
| `nmap -sp 192.168.1.1/24` | **Поиск активных устройств**<br>Nmap сканирует список устройств, подключенных и запущенных в данной подсети |
| `nmap -sS scanme.nmap.org` | **Скрытое сканирование**<br>Скрытое сканирование выполняется путем отправки SYN-пакета и анализа ответа. Если получен пакет SYN/ACK, это означает, что порт открыт, и можно открыть TCP-соединение |
| `nmap -sV scanme.nmap.org` | **Определение версий приложений**<br>важнейшая часть тестирования на проникновение. Зная версию приложения, можно найти уязвимости, например, [в базе CVE](https://cve.mitre.org/) |
| `nmap -O scanme.nmap.org` | **Определение версии операционной системы**<br>предоставлять информацию о базовой операционной системе, используя TCP/IP-фингерпринтинг |
| `nmap -A scanme.nmap.org` | **Агрессивное сканирование**<br>включает обнаружение операционной системы, определение версии, сканирование сценариев и трассировку маршрута |
| `nmap 192.164.1.1 192.164.0.2 192.164.0.2`<br>`nmap 192.164.1.*`<br>`nmap 192.164.0.1,2,3,4`<br>`nmap 192.164.0.0–255`<br>`nmap 192.164.1.0/24` | **Сканирование нескольких хостов**<br>- все IP-адреса в одну строку<br>- (*) для одновременного сканирования всех подсетей<br>- запятые, чтобы отделить окончания адресов, вместо того, чтобы вводить целые домены<br>- дефис для указания диапазона IP-адресов<br>- Можно указывать подсети |

#### Сканирование портов

| Команда | Описаине |
| :------ | :------- |
| `nmap -p 973 192.164.0.1` | для анализа одного порта |
| `nmap -p T:7777, 973 192.164.0.1` | укажете тип порта, то сможете выполнить сканирование для получения информации о конкретном типе подключения — например, для TCP-соединения |
| `nmap -p 76–973 192.164.0.1` | диапазон портов, разделив их дефисом |
| `nmap --top-ports 10 scanme.nmap.org` | указать верхние n портов для сканирования. |

#### Использование списков из файлов

```
nmap -iL input_ips.txt
```

Если вы хотите просканировать большой список IP-адресов, вы можете сделать это, используя файл со списком IP-адресов

### Вывод результата

| Команда | Описаине |
| :------ | :------- |
| `nmap -v scanme.nmap.org` | Подробный вывод |
| `nmap -oN output.txt scanme.nmap.org` | Вывод в файл |
| `nmap -oX output.xml scanme.nmap.org` | Вывод XML |
| `nmap -oA output scanme.nmap.org` | Множественные форматы |

### Поиск уязвимостей с помощью Nmap

> **Nmap Scripting Engine (NSE)**<br>это механизм, который позволяет пользователям Nmap расширять возможности сканера с помощью скриптов. Эти скрипты написаны на языке программирования Lua и могут использоваться для различных задач, включая автоматизацию сложных задач сканирования, обнаружение уязвимостей, аудит безопасности и многое другое.

Nmap по умолчанию содержит большую библиотеку различных скриптов: https://github.com/nmap/nmap

Основные возможности NSE:
- **автоматизация задач**<br>NSE позволяет автоматизировать рутинные и сложные задачи, такие как перебор учетных записей, тестирование на уязвимости и сбор информации о целевых системах;
- **обнаружение уязвимостей**<br>с помощью NSE можно искать известные уязвимости в сервисах, определенных Nmap. Это делает Nmap не просто инструментом для сканирования портов, но и сканером уязвимостей.

#### Примеры использования NSE

##### Скрипты vuln

Категория скрипта определяется в самом исходном коде

- предназначены для обнаружения известных уязвимостей в системах
- они специально разработаны для проверки хостов на наличие широкого спектра известных уязвимостей

Последовательность действий скриптов категории vuln:
1. **Собирают информацию**<br>начинают работу со сбора информации о целевой системе, включая версии запущенных сервисов и программного обеспечения.
1. **Сопоставляют информацию с базами данных уязвимостей**<br>после определения версий сервисов скрипты сравнивают их с базами данных уязвимостей, такими как Common Vulnerabilities and Exposures (CVE), чтобы определить, известны ли уязвимости для этих версий.
1. **Проверяют уязвимости**<br>скрипты могут также выполнять активные проверки, отправляя специально сформированные запросы к целевым сервисам и анализируя ответы на предмет признаков уязвимостей.
1. **Пишут отчет**<br>после завершения сканирования скрипты vuln предоставляют отчеты, в которых указываются обнаруженные уязвимости, их описание, потенциальные риски и, если это предусмотрено кодом отдельного скрипта, дополнительная информация в виде ссылок на ПО и рекомендации по устранению.

```
nmap --script=vuln <цель>
```

#### Создание собственных модулей

Подробнее про создание модулей вы можете прочитать в [туториале](https://nmap.org/book/nse-tutorial.html)

Во время проведения тестирований на проникновение внешнего сетевого периметра очень часто необходимо обеспечить покрытие [большого скоупа хостов](https://github.com/snovvcrash/DivideAndScan) за минимально возможное время.

##### Шаг 1. Создание файла скрипта

Создайте новый файл с расширением .nse в каталоге «scripts» вашего установленного Nmap. Назовем его «hello.nse»:

##### Шаг 2. Определение информации о скрипте

Каждый модуль NSE начинается с определения метаданных, которые описывают его функциональность и категорию. Это делается с помощью «description»:

```lua
description = [[
Отображает приветственное сообщение для каждого открытого порта.
Этот скрипт приведен в качестве примера, и не выполняет полезной работы.
]]
---
-- @usage
-- nmap --script=hello <target>
--
-- @output
-- PORT   STATE SERVICE
-- 22/tcp open  ssh
-- | hello:
-- |   Hello, port 22!
-- |_  Have a nice day.
---

author = "Your Name"
license = "Same as Nmap--See https://nmap.org/book/man-legal.html"
categories = {"safe", "discovery"}
```

##### Шаг 3. Определение функции скрипта

- Основная логика скрипта определяется в функции «portrule» или «hostrule», которые определяют, когда модуль должен быть выполнен.
- Затем функция «action» выполняется для каждого порта или хоста, который проходит проверку «portrule» или «hostrule»:

```lua
portrule = function(host, port)
  return port.protocol == "tcp" and port.state == "open"
end

action = function(host, port)
  return ("\nHello, port %d!\nHave a nice day."):format(port.number)
end
```

В этом примере «portrule» возвращает «true» для каждого открытого TCP-порта, и «action» выводит приветственное сообщение для каждого такого порта.

##### Шаг 4. Запуск скрипта

```bash
nmap --script=hello <target>
```

## Сканирование больших диапазонов IP-адресов

- [axiom](https://github.com/pry0cc/axiom) - В случае с очень большим размером внешнего периметра, можно использовать ресурсы облачных провайдеров
- [nrich](https://blog.shodan.io/nrich-a-tool-for-fast-ip-enrichment) - огда мы имеем дело не с очень большими объемами, наиболее оптимальным решением будет использование нескольких последовательных итераций сканирования

Далее проходимся по всему скоупу с помощью masscan, zmap, naabu, rustscan для определения открытых портов, затем запускаем nmap на полученные результаты для идентификации сервисов.

Для автоматизации этой задачи можно использовать инструмент [DivideAndScan](https://github.com/snovvcrash/DivideAndScan).

Тем, кому нужна подобная аналитика с визуализацией, рекомендуем утилиту — [nmap-did-what](https://github.com/hackertarget/nmap-did-what). Инструмент представляет собой скрипт на python, который парсит XML вывод nmap и складывает результаты в SQLite базу данных, которая в свою очередь используется как datasource для контейнера Grafana, развернутого с помощью docker compose.

# 5. Сбор информации о беспроводных сетях

## Агрегаторы Wi-Fi сетей

### WiGLE (Wireless Geographic Logging Engine

[WiGLE (Wireless Geographic Logging Engine)](https://wigle.net/) — онлайн-сервис, который собирает и отображает информацию о беспроводных сетях по всему миру.

Эта информация предоставляется пользователями, которые занимаются вардрайвингом (англ. Wardriving) — то есть собирают данные о Wi-Fi сетях.

Сервис работает по принципу краудсорсинга, где пользователи на добровольных началах собирают и отправляют данные о найденных ими сетях. Эти данные включают:
- SSID: Имя беспроводной сети.
- BSSID (MAC-адрес): Уникальный идентификатор точки доступа.
- Тип шифрования: WEP, WPA, WPA2, WPA3.
- Сигнал: Сила сигнала точки доступа.
- Географические координаты: Местоположение точки доступа.
- В некоторых случаях пароль точки доступа.

WiGLE использует полученную информацию для создания карты покрытия Wi-Fi, отображая местоположение и характеристики найденных сетей.

WiGLE также собирает информацию о Bluetooth сетях и базовых станциях мобильной сети, которую можно использовать для определения точного местоположения Wi-Fi точек доступа с помощью триангуляции.

### 3WiFi Wireless Database

[3WiFi Wireless Database](https://github.com/binarymaster/3WiFi) — проект с открытым исходным кодом, который представляет собой веб-приложение на php и базу данных с информацией о беспроводных сетях различных городов России с возможностью поиска. Данные включают:
- SSID: Имя беспроводной сети.
- BSSID (MAC-адрес): Уникальный идентификатор точки доступа.
- Тип шифрования: WEP, WPA, WPA2, WPA3.
- Сигнал: Сила сигнала точки доступа.
- Географические координаты: Местоположение точки доступа.
- Пароль точки доступа.

# Источники

- https://owasp.org/www-project-top-ten/
- https://fstec.ru/dokumenty/vse-dokumenty/spetsialnye-normativnye-dokumenty/metodicheskij-dokument-ot-28-oktyabrya-2022-g-2
- https://www.first.org/cvss/v4.0/specification-document
- https://habr.com/ru/companies/pt/articles/266485/
- https://xakep.ru/2021/02/11/dependency-confusion/
- https://portswigger.net/web-security
- https://www.ptsecurity.com/ru-ru/research/analytics/problems-in-vulnerability-management-and-how-to-solve-them/
- https://www.securitylab.ru/news/527842.php
- https://latex.codecogs.com/svg.image?V=Icvss*Iinfr
- https://bdu.fstec.ru/
- https://habr.com/ru/companies/pvs-studio/articles/677440/
- https://cwe.mitre.org/top25/archive/2023/2023_top25_list.html

# 1. Ведение

> **Cisco Packet Tracer (далее — CPT)**
> 
> симулятор сети передачи данных, разработанный компанией Cisco как раз для учебного пользования

# 2. Коммутатор. Основы Cisco IOS

## Сетевой концентраторхаб (hub).

Первый уровень модели OSI. Отправляет трафик от источника ко всем остальным портам. Изжившее себя устройство — по крайней мере на корпоративном уровне.

## Коммутатор (switch)

Второй уровень модели OSI. В соответствии с таблицей MAC-адресов отправляет пакеты в сторону конкретного получателя (порта).

## Основы Cisco IOS

### Способы подключения:

- консольный кабель;
- Telnet/SSH;
- Web;
- специализированное ПО (SDM — Security Device Manager, CSM — Cisco Security Manager, IME — IPS Manager Express).

### Алгоритм действий для первоначальной настройки:

1. Подключитесь через консольный кабель.
1. Задайте пароль для привилегированного режима.
1. Создайте пользователя.
1. Установите авторизацию на подключение к консоли.
1. Задайте IP-адрес устройства.
1. Разрешите подключение по SSH/Telnet.
1. Включите авторизацию при удалённом подключении.

## Уровни привилегий

### Level 0

Доступны следующие комманды:

- logout
- enable
- disable
- help
- exit

### Level 1

Позволяет перейти в User Exec mode, лимитированный досутп только на чтение

### Levels 2-14

Настраиваемые уровни доступа

### Level 15

Privileged Exec mode, полный доступ

## Полезные комманды

### Прерывание текущей операции

```
Ctrl Shift 6
```

### enable

Вход в привилегированный режим

### enable [0-15]

Вход с указанным уровнем привелегий

### show running-config

Просмотр текущей конфигурации

### line console [0-15]

Настройка консольной линии

### configure terminal

Вход в режим конфигурации терминала

#### write mem

Сохранение конфигурации

#### enable secret [password]

Созданиие зашифрованного пароля

#### service password-encryption

Включение шифрования паролей

#### username [Username] privilege [n:0-15] password [password]

Создания пользователя ```Username``` с максимальным уровнем привилегий ```n``` и паролем ```password```

#### line vty [0-14] или line vty [n] [m]

Конфигурирование терминальных линий (виртуальной консоли)

n - номер линии от
m - номер линии до

##### transport input [none|all|telnet|ssh]

включение\отключение ```telent``` и ```ssh```

##### end

Выход из режима конфигурации терминальных линий

# 3. VLAN

> **VLAN (Virtual Local Area Network)**
> 
> коммутатор внутри коммутатора или сегментирование сети.

## Преимущества:

- сегментирует сеть;
- увеличивает уровень безопасности;
- улучшает работу сети;
- снижает широковещательный трафик.

## Типы портов:

- Access Port — для конечных устройств;
- Trunk Port — транзитный (между коммутаторами).

## VLAN Hopping

тип атак, при котором злоумышленник получает доступ к VLAN, например, при принудительном согласовании режима работы порта.


## Защита порта

### switchport port-security

- aging — задаётся временной интервал, после которого динамический MАС-адрес может быть переписан;
- mac-address — при помощи этой ветки можно:
    - задать разрешённый MAC-адрес;
    - задать запрещённый MAC-адрес;
    - включить порт в режиме обучения;
- maximum — указывает лимит разрешённых адресов.
- violation — задаёт действие из перечисленных ранее.

После настройки применить изменения с помощью комманды ```switchport port-security``` без параметров

## Полезные комманды

### vlan [n]

Создать VLAN под номером ```n```

#### name [name]

Присвоть VLAN имя ```name```

### interface [type] [number]

Перейти в режим конфигурации интерфейся типа ```tye``` под номером ```number```

Например: ```interface fastEthernet 0/1```

#### switchport mode [access|trunc|dynamic]

Установить режим работы интерфейса:

- ```access``` режим безусловного доступа
- ```trunc``` режим безусловного транка
- ```dynamic``` атоматически определять режим

#### switchport access vlan [n]

Установить доступ на порте для VLAN под номером ```n```

#### switchport trunk allowed vlan [n,m...]

Установить транк с доступом для VLAN с номерами ```n,m...```

# 4. Методы организации отказоустойчивых каналов связи. Spanning Tree Protocol (STP)

## Методы

- Резервирование каналов
- Агрегирование каналов связи

## Резервирование каналов

> это создание автоматической системы доступа между коммутационным оборудованием. При этом существуют два или более параллельных каналов связи, дублирующих друг друга, т. е. при выходе из строя основного канала автоматически включается резервный. Таким образом доступ не прекращается и не прерывается.

### Проблема: Петля

- широковещательные штормы;
- множественные копии кадров;
- общие сбои оборудования.

### Spanning Tree Protocol (STP)

> канальный протокол. Основная задача STP — устранение петель в топологии произвольной сети Ethernet, в которой есть один или более сетевых мостов, связанных избыточными соединениями. STP решает эту задачу, автоматически блокируя соединения, которые в данный момент для полной связности коммутаторов являются избыточными.

#### Алгоритм работы

1. Выбираем корневой коммутатор. Порты корневого коммутатора становятся назначенными и переходят в состояние передачи.
1. Выбираем корневой порт на некорневом коммутаторе; он выбирается из расчёта стоимости пути от некорневого коммутатора к корневому (по количеству прыжков и скорости канала связи).

![switch stp schema](./imgs/switch_stp.png)

3. Самым последним выбираем назначенный порт — это порт, который висит в режиме ожидания.

**Если «стоимость» канала на всех линиях связи одинаковая — система выбирает корневые коммутаторы и порты по наименьшему MAC-адресу устройств.**

#### Состояния портов:

- блокировка;
- прослушивание;
- обучение;
- передача.

*Протокол STP включён на всём оборудовании Cisco по умолчанию. Если смоделировать вышеуказанный пример, то настройка произойдёт автоматически.*

### Определение корневого коммутатора

1. ```enable```
1. ```show spanning-tree```

Елси вы на корневом коммутадоре то увидите строку ```This bridge is the root```

## Агрегирование каналов связи

> это объединение нескольких физических портов в одну логическую магистраль на канальном уровне модели OSI. Оно нужно для того, чтобы образовать высокоскоростной канал передачи данных и повысить отказоустойчивость. Все избыточные связи в одном агрегированном канале остаются в рабочем состоянии, а имеющийся трафик распределяется между ними , чтобы сбалансировать нагрузку.

### Два варината

- Динамическое агрегирование:
    - LACP (Link Aggregation Control Protocol) — стандартизированный протокол, используется многими производителями оборудования.
    - PAgP (Port Aggregation Protocol) — проприетарный протокол Cisco.
- Статическое агрегирование:
    - <span style="color:green">Преимущество:</span> отсутствие задержек при поднятии агрегированного канала или изменении его настроек
    - <span style="color:red">Недостаток:</span> отсутствие согласования с другой стороной, что может стать причиной образования петель.

### Учитывать при агрегировании каналов

- одинаковую скорость портов
- режимы дуплекса
- native VLAN
- диапазон разрешённых VLAN
- trunk-статус
- типы интерфейса

### Статическое агрегирование каналов

![st agr](./imgs/stat_agr_start.png)

1. Перед соединением коммутаторов настроить порты учавствующие в аггрегации
    1. Войти в конфигурационный терминал<br>```conf terminal```
    1. Конфигурация портов (используется range для индентичной настройки сразу двух и более портов)<br>
    ```interface range GigabitEthernet 0/1-2```
    1. Задаем группу логических каналов<br>```channel-group 1 mode on```<br>
    Если успешно пример вывода:<br>
    > Creating a port-channel interface Port-channel 1
    >
    > %LINK-5-CHANGED: Interface Port-channel 1, changed state to up
    > LINEPROTO-5-UPDOWN: Line protocol on Interface Port-channel 1, changed state to up
1. Седините коммутаторы на портах ```GigabitEthernet 0/1``` и ```GigabitEthernet 0/2``` соответвенно

![static aggregation schema](./imgs/stat_agr.png)

### Динамическое агрегирование каналов LACP

![LACP schema](./imgs/lacp_start.png)

1. настройка L3 Cisco 3560
    1. ```conf terminal```
    1. Конфигурируем первую пару портов<br>
    ```int range fa0/1-2```<br>
    *скоращенная форма комманд: int - interface, fa - fastEthernet*
        1. Устанавливаем протокол LACP<br>
        ```channel-protocol lacp```
        1. Создаем группу 1 логического порта<br>
        ```channel-group 1 mode active``` 
    1. Повторяем аналогично для второй группы портов ```fa0/3-4``` с группой ```2```
    1. Созраняем ```wr mem```
1. Настраиваем L2 коммутаторы
    1. ```conf t```<br>
    *Тоже самое, что и configure terminal*
    1. Конфигурация потов fastEthernet0/1 и fastEthernet0/2<br>
    ```int range fa0/1-2```
        1. ```channel-protocol lacp```
        1. Создаем логическую группу интерфейсов 1 в пассивном режиме (в активном на L3; рекомендуется с одной стороны в активном, с другой в пассивном)<br>
        ```channel-group 1 mode passive```
    1. ```wr mem```
    1. Повторяем то же самое на 2м L2

![lacp_end](./imgs/lacp_end.png)

#### Статус EtherChannel

```show etherchannel```

```show etherchannel summary```

# 5. L3-коммутаторы

- первичная IP-маршрутизация между сегментами сети;
- используются в качестве коммутаторов уровня распределения;
- агрегирование каналов связи между коммутаторами второго уровня;
- более высокая производительность;
- более высокая стоимость за порт на конечное устройство

## Комманды

### ip routing

включение пересылки пакетов между сегментами сети.


### switchport trunk encapsulation dot1q

инкапсуляция протокола VLAN.